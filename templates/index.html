<!DOCTYPE html>

<head>
    <title>Sabi You Zone!</title>

   <!--meta-->
    <meta charset="utf-8">
     <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--Bootstrap-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <!--Map-->
    <style>
 #map {
   width: 80%;
   height: 500px;
   background-color: grey;
 }
    </style>

    <!--jquery-->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script type=text/javascript>
  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
    </script >

    <script type=text/javascript>
          var options = {
                        enableHighAccuracy: true,
                        timeout: 5000,
                         maximumAge: 0
                        };
            var pos = {lat : 5, lng : -5}
            function getPos(position) {
                               pos= {lat : position.coords.latitude,
                               lng : position.coords.longitude}
                                    };
             function error(err) {
                                    console.warn(`ERROR(${err.code}): ${err.message}`);
                                    };
            function getLocation(){ navigator.geolocation.getCurrentPosition(getPos, error, options) };
            getLocation()

     </script>


</head>


<body>
<nav class="navbar navbar-expand-lg navbar-light bg-brown" style="background-color: #A75507">
    <a class="navbar-brand" href="#"><img src="http://fcc.gov.sl/wp-content/uploads/2018/07/Freetown-City-Council-Logo-White.png" height="30" width = "120" alt=""></a>
    <span class="navbar-text" style = "color: white" >
        You Sabi You Zone?
      </span>

</nav>
<div class="container"><p> </p></div>
<div class="d-flex justify-content-center">
    <h3>Welcome Freetonian!</h3>
</div>

<div class="d-flex justify-content-center">
    <p>Don't know which ward you belong to? Don't worry!</p>
</div>
<div class="container">
    <div class="row justify-content-md-center">
            <div class="col-md-auto">
 Using your mobile device? Simply click the button below - it will take your GPS location and tell you which ward you are in.
    </div>
    </div>
        <div class="row justify-content-md-center">
            <div class="col-md-auto">
    Or select one of the wards in the dropdown to explore.    </div>
    </div>

</div>


<p></p>

<div class="container">
    <div class="row justify-content-md-center">
        <div class="col-md-auto"><a class = "btn btn-primary" role = "button" href=# id=geobutton>Use my Location</a></div>
        <div class="col-md-auto">

            <select class="form-control" id="dropdown">
                <option value=0>399</option>
                <option value=1>400</option>
                <option value=2>401</option>
                <option value=3>402</option>
                <option value=4>403</option>
                <option value=5>404</option>
                <option value=6>405</option>
            </select>

        </div>
    </div>


</div>

<p id=result>Hello</p>

<div class="d-flex justify-content-center"><div id="map"></div></div>

<div><p></p></div>
<div><p></p></div>
<div><p></p></div>


<script>
// Initialize and add the map
function initMap() {
    button = document.getElementById('geobutton');
    var mapDiv = document.getElementById('map');
    var center = new google.maps.LatLng(8.464900, -13.231235);
    var map = new google.maps.Map(mapDiv, {
          zoom: 12,
          center: center
        });

  var infowindow = new google.maps.InfoWindow({ });
  var geo_json = {{layer|tojson|safe}}
  map.data.addGeoJson(geo_json);
  map.data.setStyle({
          fillColor: 'grey',
          strokeWeight: 1
        })

  map.data.addListener('mouseover', function(event) {
          map.data.revertStyle();
          map.data.overrideStyle(event.feature, {strokeWeight: 2});
        });
map.data.addListener('click', function(event) {
  document.getElementById('<result></result>').textContent =
      event.feature.getProperty('ward');
});

google.maps.event.addDomListener(button, 'click', function() {
                $.getJSON('/postmethod',
                          pos
                         ,
                            function(data) {
                            $("#result").text(data.result.ward);
                                      var marker = new google.maps.Marker({
                                       position: pos,
                                       map: map
                                        });
                                        map.panTo(pos);
                                        map.setZoom(15);
                                        console.log(data.result);
                                         map.data.forEach(function(feature) {
                                                    map.data.remove(feature);
                                                    });
                                          map.data.addGeoJson(geo_json);
                                        map.data.addGeoJson(data.result)
                            })



        })

;

  var dropdown = document.getElementById('dropdown')
  google.maps.event.addDomListener(dropdown, 'change',
              function(){
              ward_selected = dropdown.value;
              var ward_selected_shape = geo_json["features"][ward_selected];
              map.data.forEach(function(feature) {
                                map.data.remove(feature);
                                 });
              map.data.addGeoJson(ward_selected_shape)
              });
  };





    </script>
    <!--Load the API from the specified URL
    * The async attribute allows the browser to render the page while the API loads
    * The key parameter will contain your own API key (which is not needed for this tutorial)
    * The callback parameter executes the initMap() function
    -->
    <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDgLo_BdpIcvd1CaVMpE4uCSXenKBGWabk&callback=initMap">
    </script>


</body>

</html>